<!DOCTYPE html>
<html>
<head>
    <title>Clear Storage and Login Test</title>
</head>
<body>
    <h1>Clear Storage and Test Login</h1>
    <button onclick="clearStorage()">Clear LocalStorage</button>
    <button onclick="testFullLogin()">Test Full Login Flow</button>
    <div id="result"></div>

    <script>
        function clearStorage() {
            localStorage.clear();
            console.log('LocalStorage cleared');
            document.getElementById('result').innerHTML = 'LocalStorage cleared';
        }

        async function testFullLogin() {
            try {
                // Clear storage first
                localStorage.clear();
                
                // Login
                const loginResponse = await fetch('http://localhost:5001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'john.smith@email.com',
                        password: 'password123'
                    })
                });
                const loginData = await loginResponse.json();
                console.log('Login response:', loginData);
                
                if (loginData.status === 'success') {
                    // Store in localStorage like the React app does
                    localStorage.setItem('user', JSON.stringify(loginData));
                    
                    // Test doctors endpoint
                    const doctorsResponse = await fetch('http://localhost:5001/api/users/doctors', {
                        headers: {
                            'Authorization': 'Bearer ' + loginData.token,
                            'Content-Type': 'application/json',
                        }
                    });
                    const doctorsData = await doctorsResponse.json();
                    console.log('Doctors response:', doctorsData);
                    
                    document.getElementById('result').innerHTML = 
                        '<h2>Login Success</h2>' +
                        '<p>User: ' + loginData.data.user.name + '</p>' +
                        '<p>Role: ' + loginData.data.user.role + '</p>' +
                        '<h2>Doctors Found: ' + (doctorsData.data?.doctors?.length || 0) + '</h2>' +
                        '<pre>' + JSON.stringify(doctorsData, null, 2) + '</pre>';
                } else {
                    document.getElementById('result').innerHTML = 'Login failed: ' + loginData.message;
                }
            } catch (error) {
                console.error('Test error:', error);
                document.getElementById('result').innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
